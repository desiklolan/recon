#!/usr/bin/env python3
# Written by Rafe Hart (@rafael_hart), based on a workflow by nullenc0de.

import sys
import os
from scans import *
from config import *

def main():
    if len(sys.argv) == 1:
        print("\nUsage: recon example.com\n")
        sys.exit(1)
    target = sys.argv[1]

    run_checks(amass_config)

    # Workflow
    create_directory(target)
    run_amass(target, amass_config)
    run_assetfinder(target, FB_APP_ID, FB_APP_SECRET, VT_API_KEY, SPYSE_API_TOKEN)
    run_subfinder(target)
    run_dnsbuffer(target)
    combine_subdomain_results(target)
    run_dnsgen_and_massdns(target, massdns_resolvers)
    resolve_subdomains(target)
    remove_wildcard_domains(target)
    find_http_servers(target, infile=target + '.resolved.txt', outfile=target + '.httprobe.txt')
    print_results_summary(target)
    
    # Run GIT-Endpoints
    # Run Directory Bruteforce


if __name__ == '__main__':
    main()

'''
TODO:
* Add a domain regex check: ^(((?!-))(xn--|_{1,1})?[a-z0-9-]{0,61}[a-z0-9]{1,1}\.)*(xn--)?([a-z0-9][a-z0-9\-]{0,60}|[a-z0-9-]{1,30}\.[a-z]{2,})$
* Detect that assetfinder and other go modules have been installed
* Change all functions to follow a 'target, infile, outfile' pattern, so the workflow is easier to comprehend
'''